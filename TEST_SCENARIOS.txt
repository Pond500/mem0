แนวทางทดสอบ Mem0 Custom Tool ใน Dify
==========================================

📋 เตรียมความพร้อม
------------------------------------------

1. ✅ เริ่ม services ทั้งหมด
   ./start.sh

2. ✅ ตรวจสอบว่าทำงาน
   ./status.sh

3. ✅ Copy ngrok URL จาก output
   เช่น: https://xxxx.ngrok-free.app

4. ✅ Import Custom Tool ใน Dify
   - ไปที่ Dify → Tools → Import
   - เลือก openapi.json
   - หรือใส่ URL manual


🧪 Test Scenario 1: การจดจำพื้นฐาน (Basic Memory)
------------------------------------------

วัตถุประสงค์: ทดสอบว่า agent จดจำข้อมูลพื้นฐานได้

ขั้นตอนทดสอบ:

Turn 1: แนะนำตัว
└─ พิมพ์: "สวัสดีครับ ผมชื่อสมชาย อายุ 28 ปี ทำงานเป็น developer ที่กรุงเทพ"
└─ คาดหวัง:
   ✅ Agent ตอบทักทายอย่างเป็นมิตร
   ✅ ไม่แสดง JSON หรือ technical output
   ✅ บันทึก memory เบื้องหลัง (ไม่ต้องบอก)

Turn 2: ถามคำถามทั่วไป
└─ พิมพ์: "แนะนำหนังสือเขียนโปรแกรมหน่อยครับ"
└─ คาดหวัง:
   ✅ Agent เรียกชื่อคุณได้ "สวัสดีครับคุณสมชาย..."
   ✅ ตอบคำถามโดยคำนึงว่าคุณเป็น developer
   ✅ ไม่ต้องถามซ้ำว่าคุณเป็นใคร

Turn 3: ทดสอบการจำ
└─ พิมพ์: "จำอะไรเกี่ยวกับผมได้บ้าง"
└─ คาดหวัง:
   ✅ บอกได้ว่า: ชื่อสมชาย, อายุ 28, developer, กรุงเทพ
   ✅ ข้อมูลครบถ้วนและถูกต้อง

ผลลัพธ์:
[ ] PASS - จดจำและเรียกใช้ได้ถูกต้อง
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 2: ความชอบและ Preferences
------------------------------------------

วัตถุประสงค์: ทดสอบการจดจำความชอบและใช้ในการตอบคำถาม

ขั้นตอนทดสอบ:

Turn 1: บอกความชอบ
└─ พิมพ์: "ผมชอบกินพิซซ่า และชอบดูหนังแนว Sci-Fi มาก"
└─ คาดหวัง:
   ✅ Agent รับทราบและตอบเป็นธรรมชาติ
   ✅ บันทึก preferences

Turn 2: ขอคำแนะนำที่เกี่ยวข้อง
└─ พิมพ์: "แนะนำร้านอาหารหน่อยครับ"
└─ คาดหวัง:
   ✅ แนะนำร้านพิซซ่าหรืออาหารที่เกี่ยวข้อง
   ✅ อ้างอิงว่ารู้ว่าคุณชอบพิซซ่า
   ✅ ตอบแบบเป็นส่วนตัว ไม่ใช่ generic

Turn 3: ขอคำแนะนำอื่น
└─ พิมพ์: "แนะนำหนังดูหน่อย"
└─ คาดหวัง:
   ✅ แนะนำหนัง Sci-Fi
   ✅ อ้างอิงความชอบที่บอกไว้

Turn 4 (วันถัดไป): ทดสอบความจำระยะยาว
└─ พิมพ์: "เมื่อวานผมบอกว่าชอบอะไร"
└─ คาดหวัง:
   ✅ ระบุได้ว่า: พิซซ่า และหนัง Sci-Fi
   ✅ จำได้แม้เวลาผ่านไป

ผลลัพธ์:
[ ] PASS - ใช้ preferences ได้ถูกต้อง
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 3: เป้าหมายและแผน (Goals)
------------------------------------------

วัตถุประสงค์: ทดสอบการจดจำเป้าหมายและติดตามความคืบหน้า

ขั้นตอนทดสอบ:

Turn 1: บอกเป้าหมาย
└─ พิมพ์: "ผมกำลังเรียนรู้ AI และต้องการสร้าง chatbot ด้วย Dify"
└─ คาดหวัง:
   ✅ Agent ให้กำลังใจ
   ✅ บันทึก goals

Turn 2: ขอคำแนะนำที่เกี่ยวข้อง
└─ พิมพ์: "แนะนำสิ่งที่ผมควรเรียนรู้ก่อน"
└─ คาดหวัง:
   ✅ แนะนำตาม goals ที่บอก (AI, chatbot, Dify)
   ✅ ไม่ถามซ้ำว่าต้องการเรียนอะไร

Turn 3: Update ความคืบหน้า
└─ พิมพ์: "วันนี้ผมลองสร้าง agent แรกสำเร็จแล้ว"
└─ คาดหวัง:
   ✅ Agent แสดงความยินดี
   ✅ เชื่อมโยงกับ goals เดิม
   ✅ บันทึก progress

Turn 4: ทบทวน
└─ พิมพ์: "ผมมีเป้าหมายอะไรบ้างที่บอกไว้"
└─ คาดหวัง:
   ✅ บอกได้ว่า: เรียน AI, สร้าง chatbot
   ✅ ระบุ progress: สร้าง agent แรกสำเร็จแล้ว

ผลลัพธ์:
[ ] PASS - ติดตาม goals ได้
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 4: ปัญหาและการแก้ไข (Problems)
------------------------------------------

วัตถุประสงค์: ทดสอบการจดจำปัญหาและช่วยแก้ไข

ขั้นตอนทดสอบ:

Turn 1: แจ้งปัญหา
└─ พิมพ์: "ผมมีปัญหา FastAPI routing ไม่ทำงาน endpoint /api/users"
└─ คาดหวัง:
   ✅ Agent ถามรายละเอียดเพิ่มเติม
   ✅ บันทึกปัญหา

Turn 2: ขอความช่วยเหลือ
└─ พิมพ์: "ช่วยดูทีว่าทำไมมัน 404"
└─ คาดหวัง:
   ✅ Agent จำปัญหาเดิมได้
   ✅ แนะนำวิธีแก้ไขที่เกี่ยวข้อง

Turn 3 (วันถัดไป): ติดตามปัญหา
└─ พิมพ์: "เมื่อวานผมมีปัญหาอะไร"
└─ คาดหวัง:
   ✅ บอกได้ว่า: FastAPI routing issue
   ✅ ถามว่าแก้ไขได้แล้วหรือยัง

Turn 4: แจ้งว่าแก้แล้ว
└─ พิมพ์: "แก้ไขได้แล้วครับ ขอบคุณ"
└─ คาดหวัง:
   ✅ Agent แสดงความยินดี
   ✅ Update status ของปัญหา

ผลลัพธ์:
[ ] PASS - ติดตามปัญหาได้
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 5: บริบทหลายรอบ (Multi-turn Context)
------------------------------------------

วัตถุประสงค์: ทดสอบการเชื่อมโยงบริบทข้ามหลายรอบสนทนา

ขั้นตอนทดสอบ:

Turn 1: บอกข้อมูลหลายอย่าง
└─ พิมพ์: "ผมชื่อแมกซ์ อายุ 30 ชอบดู F1 เชียร์ Red Bull และกำลังเรียน Python"
└─ คาดหวัง:
   ✅ Agent จดจำทั้งหมด

Turn 2: ถามเกี่ยวกับงานอดิเรก
└─ พิมพ์: "เมื่อวาน Red Bull ชนะไหม"
└─ คาดหวัง:
   ✅ Agent จำได้ว่าคุณชอบ F1 และเชียร์ Red Bull
   ✅ ตอบเป็นธรรมชาติ

Turn 3: ถามเกี่ยวกับการเรียน
└─ พิมพ์: "แนะนำโปรเจค Python สำหรับฝึกหัด"
└─ คาดหวัง:
   ✅ จำได้ว่ากำลังเรียน Python
   ✅ แนะนำโปรเจคที่เหมาะสม

Turn 4: ผสมหลายบริบท
└─ พิมพ์: "มี library Python ที่ใช้ดึงข้อมูล F1 ไหม"
└─ คาดหวัง:
   ✅ เชื่อมโยง Python + F1 ได้
   ✅ แนะนำที่เกี่ยวข้องทั้ง 2 ด้าน

ผลลัพธ์:
[ ] PASS - เชื่อมโยงบริบทได้
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 6: หลายผู้ใช้ (Multi-user Isolation)
------------------------------------------

วัตถุประสงค์: ทดสอบว่า memory แยกตาม user_id ถูกต้อง

ขั้นตอนทดสอบ:

User 1 (คุณ):
└─ พิมพ์: "ผมชื่อจอห์น ชอบ Python"
└─ คาดหวัง: บันทึกเป็น user_id ของคุณ

User 2 (เพื่อน):
└─ ให้เพื่อนสร้าง conversation ใหม่
└─ พิมพ์: "ผมชื่อโจ ชอบ JavaScript"
└─ คาดหวัง: บันทึกเป็น user_id ของเพื่อน

User 1 กลับมาถาม:
└─ พิมพ์: "ผมชอบภาษาอะไร"
└─ คาดหวัง:
   ✅ บอก Python (ไม่ใช่ JavaScript)
   ✅ ไม่สับสนระหว่าง users

User 2 ถาม:
└─ พิมพ์: "ผมชื่ออะไร"
└─ คาดหวัง:
   ✅ บอก "โจ" (ไม่ใช่ "จอห์น")
   ✅ Memory แยกกันชัดเจน

ผลลัพธ์:
[ ] PASS - แยก user ได้ถูกต้อง
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 7: การอัพเดทข้อมูล (Update Info)
------------------------------------------

วัตถุประสงค์: ทดสอบการอัพเดทข้อมูลเก่า

ขั้นตอนทดสอบ:

Turn 1: บอกข้อมูลเดิม
└─ พิมพ์: "ผมอายุ 25 ปี"
└─ คาดหวัง: จดจำอายุ 25

Turn 2: อัพเดทข้อมูล
└─ พิมพ์: "แก้ไขนะครับ จริงๆ ผมอายุ 26 ปี"
└─ คาดหวัง:
   ✅ Agent รับทราบการแก้ไข
   ✅ อัพเดท memory

Turn 3: ตรวจสอบ
└─ พิมพ์: "ผมอายุเท่าไหร่"
└─ คาดหวัง:
   ✅ บอก 26 (ไม่ใช่ 25)
   ✅ ข้อมูลเป็นปัจจุบัน

ผลลัพธ์:
[ ] PASS - อัพเดทข้อมูลได้
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 8: ความจำระยะยาว (Long-term Memory)
------------------------------------------

วัตถุประสงค์: ทดสอบว่าจำได้นานแค่ไหน

ขั้นตอนทดสอบ:

Day 1: บอกข้อมูล
└─ พิมพ์: "ผมชอบกาแฟ Americano และขนมปังครัวซองต์"
└─ คาดหวัง: บันทึก

Day 2: ทดสอบ (24 ชั่วโมงผ่านไป)
└─ พิมพ์: "แนะนำร้านกาแฟหน่อย"
└─ คาดหวัง:
   ✅ จำได้ว่าชอบ Americano
   ✅ แนะนำร้านที่มี Americano

Day 7: ทดสอบ (1 สัปดาห์ผ่านไป)
└─ พิมพ์: "จำไหมว่าผมชอบกินอะไร"
└─ คาดหวัง:
   ✅ จำได้: กาแฟ Americano, ครัวซองต์
   ✅ ข้อมูลไม่หาย

ผลลัพธ์:
[ ] PASS - จำได้ระยะยาว
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 9: Error Handling
------------------------------------------

วัตถุประสงค์: ทดสอบการจัดการเมื่อ memory tools มีปัญหา

ขั้นตอนทดสอบ:

Turn 1: ปิด Qdrant ชั่วคราว
└─ หยุด: docker stop mem0-qdrant
└─ พิมพ์: "สวัสดีครับ"
└─ คาดหวัง:
   ✅ Agent ยังตอบได้ปกติ
   ✅ ไม่แสดง error ให้ผู้ใช้เห็น
   ✅ ไม่พูดถึง technical issue

Turn 2: เปิด Qdrant กลับมา
└─ เริ่ม: docker start mem0-qdrant
└─ รอ 5 วินาที
└─ พิมพ์: "ผมชื่อจอห์น"
└─ คาดหวัง:
   ✅ กลับมาทำงานปกติ
   ✅ บันทึก memory ได้

ผลลัพธ์:
[ ] PASS - Handle errors ได้
[ ] FAIL - ระบุปัญหา: _________________


🧪 Test Scenario 10: ภาษาไทย + English Mixed
------------------------------------------

วัตถุประสงค์: ทดสอบการทำงานกับภาษาผสม

ขั้นตอนทดสอบ:

Turn 1: บอกภาษาผสม
└─ พิมพ์: "ผมชอบ Python และ FastAPI framework มาก"
└─ คาดหวัง: บันทึกทั้งสองภาษา

Turn 2: ถามเป็นไทย
└─ พิมพ์: "ผมชอบอะไร"
└─ คาดหวัง:
   ✅ บอกได้ทั้งไทยและอังกฤษ
   ✅ ค้นหา memory แบบ multilingual

Turn 3: ถามเป็นอังกฤษ
└─ พิมพ์: "What do I like?"
└─ คาดหวัง:
   ✅ ค้นหาและตอบได้
   ✅ รองรับทั้งสองภาษา

ผลลัพธ์:
[ ] PASS - รองรับหลายภาษา
[ ] FAIL - ระบุปัญหา: _________________


📊 สรุปผลการทดสอบ
------------------------------------------

Scenario                              | Status  | หมายเหตุ
--------------------------------------|---------|------------------
1. การจดจำพื้นฐาน                     | [ ]     |
2. ความชอบและ Preferences             | [ ]     |
3. เป้าหมายและแผน                     | [ ]     |
4. ปัญหาและการแก้ไข                   | [ ]     |
5. บริบทหลายรอบ                       | [ ]     |
6. หลายผู้ใช้                          | [ ]     |
7. การอัพเดทข้อมูล                    | [ ]     |
8. ความจำระยะยาว                       | [ ]     |
9. Error Handling                     | [ ]     |
10. ภาษาไทย + English                 | [ ]     |


🔍 ตรวจสอบ Backend (Optional)
------------------------------------------

ระหว่างทดสอบ สามารถเช็คได้ว่า memory บันทึกจริงหรือไม่:

1. ดู Qdrant Dashboard:
   http://localhost:6333/dashboard

2. ตรวจสอบ collections:
   curl http://localhost:6333/collections

3. ดูจำนวน memories:
   curl "http://localhost:8000/memory/all?user_id=YOUR_USER_ID"

4. ดู logs:
   ./logs.sh


💡 Tips สำหรับการทดสอบ
------------------------------------------

1. ✅ ทดสอบทีละ scenario อย่างละเอียด
2. ✅ บันทึก screenshots เมื่อเจอปัญหา
3. ✅ ทดสอบกับ user หลายคน
4. ✅ ลองพิมพ์แบบต่างๆ (สั้น, ยาว, ผสมภาษา)
5. ✅ ตรวจ backend เป็นระยะ
6. ✅ ทดสอบในเวลาต่างกัน (test long-term)
7. ✅ ลอง edge cases (ข้อมูลผิด, แก้ไข, ลบ)


🐛 Common Issues & Solutions
------------------------------------------

ปัญหา: Agent แสดง JSON output
└─ แก้: เช็ค Agent Mode ต้องเป็น Function Calling
       ปิด "Show Reasoning Process"

ปัญหา: ไม่จดจำข้อมูล
└─ แก้: เช็ค user_id ถูกส่งไปหรือไม่
       ดู logs: ./logs.sh

ปัญหา: จำข้อมูลผิด
└─ แก้: เช็ค Instruction ว่าชัดเจนพอไหม
       ดู memory format ที่บันทึก

ปัญหา: ช้า
└─ แก้: เช็ค embedding model (bge-m3 ใช้ local)
       ลด limit ใน searchMemories

ปัญหา: Memory หาย
└─ แก้: เช็ค Qdrant volume ยังอยู่ไหม
       อย่าใช้ docker-compose down -v


📝 Checklist ก่อนทดสอบ
------------------------------------------

[ ] Services ทั้งหมดรันอยู่ (./start.sh)
[ ] ngrok tunnel พร้อมใช้งาน
[ ] Custom tool import ใน Dify แล้ว
[ ] Agent Instructions ตั้งค่าแล้ว
[ ] มี test users หลายคน
[ ] พร้อมบันทึกผล

เริ่มทดสอบได้เลย! 🚀

version: '3.8'

services:
  # Qdrant Vector Database
  qdrant:
    image: qdrant/qdrant:latest
    container_name: mem0-qdrant
    ports:
      - "6333:6333" # REST API
      - "6334:6334" # gRPC
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334
    networks:
      - mem0-network
    restart: unless-stopped

  # Neo4j Graph Database
  neo4j:
    image: neo4j:latest
    container_name: mem0-neo4j
    ports:
      - "7474:7474" # HTTP
      - "7687:7687" # Bolt
    environment:
      - NEO4J_AUTH=neo4j/password
    volumes:
      - neo4j_data:/data
    networks:
      - mem0-network
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "wget", "-q", "--spider", "http://localhost:7474" ]
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 30s

  # Mem0 Application
  mem0-app:
    build: .
    container_name: mem0-app
    ports:
      - "8000:8000"
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_BASE_URL=${LLM_BASE_URL}
      - LLM_MODEL=${LLM_MODEL}
      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL}
    depends_on:
      qdrant:
        condition: service_started
      neo4j:
        condition: service_healthy
    volumes:
      - ./app:/app
      - ./data:/data
    networks:
      - mem0-network
    restart: unless-stopped
    command: python main.py

networks:
  mem0-network:
    driver: bridge

volumes:
  qdrant_storage:
  neo4j_data:
